# Docker Compose Override for Development
# This file is automatically loaded alongside docker-compose.yml
# It overrides settings for local development

version: '3.8'

services:
  # API - Development overrides
  api:
    build:
      target: builder
      args:
        - NODE_ENV=development
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    volumes:
      # Mount source code for hot reload
      - ./packages/core:/app/packages/core
      - ./apps/api:/app/apps/api
      - /app/apps/api/node_modules
      - /app/apps/api/dist
    command: pnpm --filter @adashield/api dev

  # Worker - Development overrides
  worker:
    build:
      target: builder
      args:
        - NODE_ENV=development
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
      PLAYWRIGHT_HEADLESS: 'false'
    volumes:
      # Mount source code for hot reload
      - ./packages/core:/app/packages/core
      - ./apps/worker:/app/apps/worker
      - /app/apps/worker/node_modules
      - /app/apps/worker/dist
    command: pnpm --filter @adashield/worker dev

  # Web - Development overrides
  web:
    build:
      target: deps
      args:
        - NODE_ENV=development
    environment:
      NODE_ENV: development
    volumes:
      # Mount source code for hot reload
      - ./packages/core:/app/packages/core
      - ./apps/web:/app/apps/web
      - /app/apps/web/node_modules
      - /app/apps/web/.next
    command: pnpm --filter @adashield/web dev

  # PostgreSQL - Development overrides
  postgres:
    environment:
      POSTGRES_PASSWORD: postgres
    # Ports defined in docker-compose.yml with env vars

  # Redis - Development overrides
  redis: {}
    # Ports defined in docker-compose.yml with env vars

  # MinIO - Development overrides
  minio:
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    # Ports defined in docker-compose.yml with env vars
